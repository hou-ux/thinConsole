class thinConsole{constructor(e={}){if(thinConsole.tC)return this.warn("[thinConsole] A thinConsole instance already exists."),thinConsole.tC;switch(e=this.sanitizeOptions(e),thinConsole.tC=this,this.version="1.0.5",this.options={text:"thinConsole",color:"#007aff",width:"auto",height:"auto",theme:"auto",plugins:!0,disabledPlugins:[],jsExecute:!0,maxLog:1e3,...e},this.options.theme){case"light":this.currentTheme="light";break;case"dark":this.currentTheme="dark";break;default:let e=()=>window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";this.currentTheme=e(),this.mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this.themeChangeHandler=e=>{this.currentTheme=e.matches?"dark":"light",this.overlay&&this.overlay.classList.contains("active")&&(this.overlay.className="overlay active theme-"+this.currentTheme)},this.mediaQuery.addEventListener("change",this.themeChangeHandler)}this.currentTab="console",void 0===e.pos?.x&&void 0===e.pos?.y&&(this.options.pos=this.getSavedBtnPos()||{x:30,y:30}),this.pluginEnabled=this.options.plugins,this.disabledPlugins=this.options.disabledPlugins,this.plugins={},this.pluginTabs={},this.pluginViewContainers={},this.logs=[],this.systemLogs=[],this.lastLog=null,this.maxLog=this.options.maxLog,this.jsonPageSize=200,this.lsJsonPageSize=200,this.jsonPageCache=new Map,this.jsonPageIndex=new Map,this.lsJsonPageIndex=new Map,this.timerMap=new Map,this.countMap=new Map,this.createStyles(),this.createButton(),this.captureConsoleLogs(),this.createNotificationElement(),this.createOverlayElement(),this.setupGlobalEventHandlers(),this.setupSelfProtection(),this.initShortcuts(),this.renderContent()}sanitizeOptions(e){let t={text:"thinConsole",color:"#007aff",width:"auto",height:"auto",theme:"auto",plugins:!0,disabledPlugins:[],jsExecute:!0,pos:null,maxLog:1e3};if(!e||"object"!=typeof e)return{...t};let o={...t},s=(e,t=200)=>"string"==typeof e&&e.length<=t&&!/[<>"&]/.test(e)?e:void 0;for(let i of Object.keys(e)){if(!(i in t))continue;let n=e[i];switch(i){case"text":case"color":case"width":case"height":case"theme":{let e=s(n);void 0!==e&&(o[i]=e);break}case"plugins":case"jsExecute":"boolean"==typeof n&&(o[i]=n);break;case"disabledPlugins":Array.isArray(n)&&n.every(e=>"string"==typeof e)&&(o[i]=n.slice(0,100));case"pos":n&&"object"==typeof n&&"number"==typeof n.x&&"number"==typeof n.y&&(o.pos={x:n.x,y:n.y});break;case"maxLog":{let t=Number(e[i]);!isNaN(t)&&t>0&&(o[i]=Math.floor(t));break}}}return o}createButton(){this.btn=document.createElement("button"),this.btn.id="thinConsole-btn",this.btn.className="floating-console-btn",this.btn.textContent=this.options.text.slice(0,11),this.btn.style.background=this.options.color,this.btn.style.width=this.options.width,this.btn.style.height=this.options.height,this.btn.style.bottom=(Number(this.options.pos.y)||30)+"px",this.btn.style.right=(Number(this.options.pos.x)||30)+"px",this.btn.title=this.options.text.slice(0,11),document.documentElement.append(this.btn);let e=!1,t=0,o=0,s=0,i=0,n=0,a=0,r=null,l=null,c=0,d=0,h=()=>{r&&(clearTimeout(r),r=null)},g=()=>{if(!e)return;let t=c-s,o=d-i;this.btn.style.transform=`translate3d(${t}px,${o}px,0)`,l=requestAnimationFrame(g)},p=r=>{if(!e)return;let l=r.touches?r.touches[0]:r,h=l.clientX-t,g=l.clientY-o;c=Math.max(n/2,Math.min(innerWidth-n/2,s+h)),d=Math.max(a/2,Math.min(innerHeight-a/2,i+g)),r.preventDefault()},u=()=>{if(h(),!e)return;e=!1,cancelAnimationFrame(l);let t=this.btn.getBoundingClientRect(),o=Math.round(innerWidth-t.right),s=Math.round(innerHeight-t.bottom);this.btn.style.right=Math.max(0,o)+"px",this.btn.style.bottom=Math.max(0,s)+"px",this.saveBtnPos({x:Math.max(0,o),y:Math.max(0,s)}),this.btn.style.transform="",this.btn.dataset.right=Math.max(0,o),this.btn.dataset.bottom=Math.max(0,s),this.btn.removeEventListener("touchmove",p,{passive:!1}),this.btn.removeEventListener("touchend",u),this.btn.removeEventListener("mousemove",p),this.btn.removeEventListener("mouseup",u)},f=l=>{let h=l.touches?l.touches[0]:l;t=h.clientX,o=h.clientY;let f=this.btn.getBoundingClientRect();n=f.width,a=f.height,s=f.left+n/2,i=f.top+a/2,r=setTimeout(()=>{e=!0,c=s,d=i,g(),this.btn.addEventListener("touchmove",p,{passive:!1}),this.btn.addEventListener("touchend",u),this.btn.addEventListener("mousemove",p),this.btn.addEventListener("mouseup",u)},500)};this.btn.addEventListener("touchstart",f,{passive:!1}),this.btn.addEventListener("mousedown",f),this.btn.addEventListener("touchend",h),this.btn.addEventListener("mouseup",h),this.btn.addEventListener("mouseleave",h),this.btn.addEventListener("click",()=>{this.triggerGlobalHook("beforeOpen"),this.overlay.className="overlay active theme-"+this.currentTheme,this.renderContent(),this.triggerGlobalHook("afterOpen")})}saveBtnPos({x:e,y:t}){e=isNaN(Number(e))?30:Number(e),t=isNaN(Number(t))?30:Number(t),localStorage.setItem("tC-Button-pos",`x:${e},y:${t}`)}getSavedBtnPos(){let e=localStorage.getItem("tC-Button-pos");if(!e)return this.saveBtnPos({x:30,y:30}),null;let t=e.match(/^x:(.+?)\,y:(.+)$/);if(!t)return this.saveBtnPos({x:30,y:30}),null;let o=Number(t[1]),s=Number(t[2]);return isNaN(o)||isNaN(s)?(this.saveBtnPos({x:30,y:30}),null):{x:o,y:s}}createOverlayElement(){this.overlay=document.createElement("div"),this.overlay.id="consoleOverlay",this.overlay.className="overlay",this.overlay.innerHTML=`<div class="console-container"><div class="console-header"><div class="console-title"><i class="fa fa-terminal"></i>${this.options.text.slice(0,11)}</div><button class="clear-all-btn" title="Clear" id="clearLogsBtn"><i class="fa fa-trash-alt"></i></button><button class="close-btn" title="Close" id="closeConsoleBtn"><i class="fa fa-times"></i></button></div><div class="tabs" id="tabsContainer"></div><div class="console-content" id="contentArea"><div class="controls" id="consoleControls"><div class="filters"><button class="filter-btn active" title="All" data-type="all"><i class="fa fa-stream"></i>All</button><button class="filter-btn" title="Log" data-type="log"><i class="fa fa-info"></i>Log</button><button class="filter-btn" title="Info" data-type="info"><i class="fa fa-info-circle"></i>Info</button><button class="filter-btn" title="Warn" data-type="warn"><i class="fa fa-exclamation-triangle"></i>Warn</button><button class="filter-btn" title="Error" data-type="error"><i class="fa fa-times-circle"></i>Error</button></div><div class="search-box" title="Search logs..."><input type="text" id="searchInput" placeholder="Search logs..."></div></div><div class="console-output" id="consoleOutput"></div><div class="localstorage-view" id="localstorageView" style="display:none"><div class="ls-header"><button id="addLSItemBtn" class="push-btn" title="Add new Item"><i class="fa fa-plus"></i>Add new item</button></div><div class="ls-items" id="lsItems"></div></div><div class="system-logs" id="systemLogs" style="display:none"></div></div></div>`,document.querySelector("html").appendChild(this.overlay),this.tabButtonsContainer=this.overlay.querySelector("#tabsContainer"),this.createBuiltinTabs(),this.closeConsoleBtn=this.overlay.querySelector("#closeConsoleBtn"),this.consoleOutput=this.overlay.querySelector("#consoleOutput"),this.title=this.overlay.querySelector(".console-title"),this.localstorageView=this.overlay.querySelector("#localstorageView"),this.lsItems=this.overlay.querySelector("#lsItems"),this.systemLogsEl=this.overlay.querySelector("#systemLogs"),this.contentArea=this.overlay.querySelector("#contentArea"),this.filterButtons=this.overlay.querySelectorAll(".filter-btn"),this.searchInput=this.overlay.querySelector("#searchInput"),this.clearLogsBtn=this.overlay.querySelector("#clearLogsBtn"),this.tabButtons=this.overlay.querySelectorAll(".tab-btn"),this.consoleControls=this.overlay.querySelector("#consoleControls"),this.addLSItemBtn=this.overlay.querySelector("#addLSItemBtn"),this.closeConsoleBtn.addEventListener("click",()=>{this.triggerGlobalHook("beforeClose"),this.overlay.classList.remove("active"),this.triggerGlobalHook("afterClose")}),this.lsItems.addEventListener("click",e=>{let t=e.target.closest(".ls-action-btn");if(!t)return;let o=t.dataset.action,s=t.dataset.key;switch(o){case"edit":this.editLSItem(s);break;case"copy":this.copyLog(s,"",!0);break;case"remove":this.removeLSItem(s);break;case"cancel":this.cancelEditLSItem(s);break;case"save":this.saveLSItem(s)}}),this.title.title="The code execution feature has been disabled",this.title.cursor="not-allowed",this.options.jsExecute&&(this.title.title="You can click the title to enter code to execute",this.title.cursor="pointer",this.title.addEventListener("click",function(){let code=prompt("Please enter the code to execute:");if(null!=code&&code.trim())try{let result;result=eval(code),console.log(`${code}\n>`,result)}catch(e){console.error(`${code}\n> Execution failed:${e}`)}}.bind(window))),this.overlay.addEventListener("click",e=>{let t=e.target.closest(".json-page-btn");t&&this.changeJsonPage(parseInt(t.dataset.id),parseInt(t.dataset.page,10));let o=e.target.closest(".ls-json-page-btn");o&&this.changeLSJsonPage(decodeURIComponent(o.dataset.key),parseInt(o.dataset.page,10)),e.target===this.overlay&&(this.triggerGlobalHook("beforeClose"),this.overlay.classList.remove("active"),this.triggerGlobalHook("afterClose"))}),[this.consoleOutput,this.systemLogsEl].forEach(e=>e.addEventListener("scroll",()=>e.dataset.bottom=Math.max(0,e.scrollHeight-e.scrollTop-e.clientHeight))),this.filterButtons.forEach(e=>{e.addEventListener("click",()=>{this.filterButtons.forEach(e=>e.classList.remove("active")),e.classList.add("active"),this.activeFilter=e.dataset.type,this.updateFilterCounts(),this.renderContent()})}),this.searchInput.addEventListener("input",(e=>t=>{clearTimeout(e),e=setTimeout(()=>{this.searchQuery=t.target.value.toLowerCase().trim(),this.renderContent()},300)})(0)),this.clearLogsBtn.addEventListener("click",()=>this.clearAllLogs()),this.tabButtons.forEach(e=>{e.addEventListener("click",()=>{this.tabButtons.forEach(e=>e.classList.remove("active")),e.classList.add("active"),this.currentTab=e.dataset.tab,this.renderContent()})}),this.addLSItemBtn.addEventListener("click",()=>this.addLSItem())}createBuiltinTabs(){[{id:"console",name:"Console",icon:"fa fa-terminal"},{id:"system",name:"System",icon:"fa fa-server"},{id:"localstorage",name:"LocalStorage",icon:"fa fa-database"}].forEach(e=>{let t=document.createElement("button");t.className="tab-btn",t.dataset.tab=e.id,t.title=e.name,t.innerHTML=`<i class="${e.icon}"></i>${e.name}`,"console"===e.id&&t.classList.add("active"),t.addEventListener("click",()=>{this.tabButtons=this.overlay.querySelectorAll(".tab-btn"),this.tabButtons.forEach(e=>e.classList.remove("active")),t.classList.add("active"),this.currentTab=e.id,this.renderContent()}),this.tabButtonsContainer.appendChild(t)})}createPluginTab(e){let t=document.createElement("button");t.className="tab-btn",t.dataset.tab=e.id?e.id:"newTab",t.title=e.name?e.name:"New Plugin",t.innerHTML=`<i class="${e.icon?e.icon:"fa fa-plug"}"></i>${e.name?e.name:"New Plugin"}`,this.tabButtonsContainer.appendChild(t),t.addEventListener("click",()=>{this.tabButtons=this.overlay.querySelectorAll(".tab-btn"),this.tabButtons.forEach(e=>e.classList.remove("active")),t.classList.add("active"),this.currentTab=e.id,this.renderContent()});let o=document.createElement("div");o.id=`${e.id}View`,o.innerHTML="<center style='font-size:20px;margin-top:30px;color:var(--text-color);'><i class='fa fa-info-circle'></i>No plugin view</center>",o.className="plug-view",o.style.display="none",this.contentArea.appendChild(o),this.pluginViewContainers[e.id]=o}createNotificationElement(){this.notification=document.createElement("div"),this.notification.id="notification",this.notification.className="notification",this.notification.textContent="Copied to clipboard",document.documentElement.appendChild(this.notification)}createStyles(){let e=document.createElement("style");e.innerHTML='@import url("https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css");*{margin:0;padding:0;box-sizing:border-box}.floating-console-btn{position:fixed;z-index:11000;padding:15px 25px;backdrop-filter:blur(5px);border-radius:5px;border:none;background:#007aff;color:white;font-size:1rem;cursor:move;display:flex;align-items:center;gap:10px;font-weight:500;box-shadow:0 8px 20px rgba(0,0,0,0.4);transition:all 0.3s ease;user-select:none}.floating-console-btn:active{transform:scale(0.98)}.floating-console-btn i{font-size:1.2rem}.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:99998;opacity:0;visibility:hidden;transition:all 0.4s ease;backdrop-filter:blur(5px)}.overlay.active{opacity:1;visibility:visible}.theme-dark{--console-bg:#1e1e1e;--header-bg:#252526;--text-color:#d4d4d4;--controls-bg:#2d2d2d;--border-color:rgba(255,255,255,0.05);--log-bg:#191919;--log-border-light:3px solid;--filter-active:#4a4ae6;--search-bg:#3e3e42;--json-bg:rgba(40,40,40,0.7);--json-key:#6aaeff;--json-string:#98c379;--json-number:#d19a66;--json-boolean:#56b6c2;--json-null:#be5046;--action-bg:rgba(106,174,255,0.3);--action-hover:rgba(106,174,255,0.5);--log-icon-info:#4a4ae6;--log-icon-warn:#d9a40d;--log-bg-warn:rgba(255,193,7,0.1);--log-icon-error:#ff3b30;--clear-btn-color:#ff6b6b;--clear-btn-hover:#ff5252;--tab-bg:#333;--tab-active:#444;--tab-color:#ddd}.theme-light{--console-bg:#ffffff;--header-bg:#f0f0f0;--text-color:#333;--controls-bg:#e0e0e0;--border-color:rgba(0,0,0,0.1);--log-bg:#f3f3f3;--log-border-light:3px solid;--filter-active:#4a4ae6;--search-bg:#f0f0f0;--json-bg:rgba(240,240,240,0.9);--json-key:#1e6bb8;--json-string:#22863a;--json-number:#d73a49;--json-boolean:#005cc5;--json-null:#6f42c1;--action-bg:rgba(30,107,184,0.1);--action-hover:rgba(30,107,184,0.2);--log-icon-info:#1e6bb8;--log-icon-warn:#e36209;--log-bg-warn:rgba(255,243,205,0.75);--log-icon-error:#d73a49;--clear-btn-color:#ff5252;--clear-btn-hover:#ff3b30;--tab-bg:#e5e5e5;--tab-active:#ddd;--tab-color:#333}.console-container{background:var(--console-bg);overflow:hidden;display:flex;flex-direction:column;box-shadow:0 15px 35px rgba(0,0,0,0.3);position:fixed;z-index:99999;left:0;bottom:0;width:100%;height:90vh;transform:translateY(100%);transition:transform 0.4s cubic-bezier(.25,.8,.25,1);}.overlay.active .console-container{transform:translateY(0)}.console-header{display:flex;justify-content:space-between;align-items:center;padding:15px 25px;background:var(--header-bg);border-bottom:1px solid var(--border-color);position:relative}.console-title{font-size:1.3rem;color:var(--text-color);gap:10px;display:flex;align-items:center}.push-btn .fa{margin-right:5px}.push-btn{border:none;background:var(--filter-active);color:white;padding:10px;border-radius:5px}.close-btn{background:transparent;border:none;color:var(--text-color);font-size:1.5rem;cursor:pointer;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:5px;transition:all 0.3s}.close-btn:hover{background:rgba(255,100,100,0.2);color:#ff6464;transform:scale(1.1)}.clear-all-btn{position:absolute;top:50%;right:50px;transform:translateY(-50%);background:transparent;border:none;color:var(--clear-btn-color);font-size:1.5rem;cursor:pointer;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:5px;transition:all 0.3s;margin-left:0}.clear-all-btn:hover{background:rgba(255,100,100,0.2);color:var(--clear-btn-hover)}.tabs{display:block;white-space:nowrap;overflow-x:auto;background:var(--tab-bg);padding:5px 10px 0;border-bottom:1px solid var(--border-color)}.tab-btn{padding:12px 20px;background:transparent;border-radius:5px 5px 0 0;border:none;color:var(--tab-color);font-size:1rem;cursor:pointer;position:relative;transition:all 0.2s;display:inline-flex;align-items:center;gap:8px}.tab-btn.active{color:var(--text-color);font-weight:600}.tab-btn.active::after{content:\'\';position:absolute;bottom:0;left:0;width:100%;height:2px;border-radius:3px;background:var(--filter-active)}.tab-btn:hover:not(.active){background:rgba(255,255,255,0.05)}.controls{display:flex;padding:15px 20px;background:var(--controls-bg);gap:15px;flex-wrap:wrap;border-bottom:1px solid var(--border-color);align-items:center}.filters{display:flex;flex-wrap:nowrap;margin-left:-5px}.filter-btn>.fa{margin-right:5px;margin-top:1px}.filter-btn{position:relative;padding:10px;border:none;background:none;color:var(--text-color);cursor:pointer;font-size:0.85rem;transition:all 0.2s;display:flex;width:100%;white-space:nowrap}.filter-btn.active::after{content:"";position:absolute;width:90%;transition:all 0.3s ease;left:3px;height:2px;top:90%;border-radius:3px;background:var(--filter-active);color:white}.search-box{display:flex;flex-grow:1;max-width:400px}.search-box input{padding:10px 15px;border-radius:5px;border:none;background:var(--search-bg);color:var(--text-color);width:100%;transition:all 0.3s ease;font-size:0.95rem;border:1px solid var(--border-color)}.search-box input:focus{outline:none;border-color:#4a4ae6}.console-content{flex:1;overflow:hidden;display:flex;flex-direction:column}.console-output,.localstorage-view,.system-logs{flex:1;overflow-y:auto;padding:20px;font-family:monospace;font-size:0.95rem}.log-item{padding:10px 15px;margin-bottom:10px;display:flex;align-items:flex-start;border-left:var(--log-border-light) #4a4ae6;background:var(--log-bg);border-radius:5px}.log-item.log{border-left-color:#4a4ae6}.log-item.info{border-left-color:var(--log-icon-info)}.log-item.warn{border-left-color:var(--log-icon-warn);background:var(--log-bg-warn)}.log-item.error{border-left-color:var(--log-icon-error);background:rgba(255,59,48,0.15)}.log-count{background:#4a4ae6;color:white;border-radius:5px;min-width:28px;height:28px;display:flex;align-items:center;justify-content:center;font-size:0.85rem;margin-right:10px;margin-top:-3px;padding:10px}.log-icon{margin-right:12px;font-size:1rem;min-width:20px;color:var(--text-color)}.log-content{width:100%;max-height:500px;overflow-y:auto;flex-grow:1;word-break:break-word;line-height:1.5;color:var(--text-color)}.timestamp{color:#707070;font-size:0.8rem;margin-left:10px;white-space:nowrap}.normal-timestamp{margin-top:-30px !important}.hasobj-tsp{margin-left:150px !important}.json-preview{font-family:monospace;padding:10px;margin-top:5px;background:var(--json-bg);border-radius:5px;white-space:pre !important;word-break:break-all ！important;max-height:400px;overflow:auto}.json-page-btn,.ls-json-page-btn{border:none}.ls-json-preview{border-radius:5px;margin-top:-5px}.json-number{color:var(--json-number)}.json-boolean{color:var(--json-boolean)}.json-key{color:var(--json-key)}.json-null{color:var(--json-null)}.json-string{color:var(--json-string)}.json-cmt{color:#707070}.log-actions{margin-top:8px;display:flex;gap:10px;font-size:0.85rem}.log-action{color:var(--json-key);cursor:pointer;padding:5px 10px;background:var(--action-bg);transition:all 0.2s;display:inline-flex;align-items:center;gap:5px;border-radius:5px}.log-action:hover{background:var(--action-hover)}.log-action.copy-btn{background:var(--action-bg)}.log-action.copy-btn:hover{background:var(--action-hover)}.error-stack{font-family:monospace;padding:10px;margin-top:10px;background:rgba(255,59,48,0.1);border-radius:5px;white-space:pre-wrap;word-break:break-all;color:#ff8a80;font-size:0.85rem}.object-preview{font-family:monospace;padding:10px;margin-top:5px;background:var(--json-bg);color:var(--json-number);border-radius:5px}.function-preview{font-family:monospace;padding:10px;margin-top:5px;background:var(--json-bg);color:var(--json-boolean);border-radius:5px;white-space:pre;word-break:break-all;overflow-x:auto}.ls-header{padding:15px 0;display:flex;justify-content:flex-end}.ls-item{background:var(--log-bg);padding:15px;margin-bottom:15px;border-radius:8px}.ls-key-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;border-bottom:1px solid var(--border-color);padding-bottom:10px}.ls-key{color:var(--json-key);font-size:1.1rem;max-width:60%;overflow-x:auto;white-space:nowrap}.ls-actions{display:flex;gap:8px}.ls-action-btn{background:var(--action-bg);border:none;color:var(--text-color);padding:5px 10px;border-radius:5px;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:5px}.ls-action-btn:hover{background:var(--action-hover)}.ls-value{white-space:normal;word-break:break-all;padding:10px;background:var(--json-bg);border-radius:5px;font-family:monospace;max-height:200px;overflow-y:auto;color:var(--text-color)}.ls-edit{display:flex;flex-direction:column;gap:10px;margin-top:10px;display:none}.ls-edit textarea{width:100%;min-height:100px;padding:10px;background:var(--search-bg);border:1px solid var(--border-color);border-radius:5px;color:var(--text-color);font-family:monospace;resize:vertical;outline:none;transition:all 0.3s ease}.ls-edit textarea:focus{border-color:#4a4ae6}.ls-key-edit{display:none;width:60%;padding:6px 10px;border:1px solid var(--border-color);border-radius:5px;background:var(--search-bg);font-size:1.1rem;outline:none;transition:border .2s;color:var(--json-key);font-family:monospace;}.ls-key-edit:focus{border-color:#4a4ae6;}.ls-item.editing .ls-key{display:none;}.ls-item.editing .ls-key-edit{display:block;}.ls-edit-actions{display:flex;gap:10px;justify-content:flex-end}.ls-value-type{font-size:0.8rem;opacity:0.7;margin-top:5px;color:var(--text-color)}.system-log-content{width:100%;max-height:300px;overflow-y:auto;font-family:monospace;white-space:pre-wrap;word-break:break-word;color:var(--text-color)}.system-log-date{font-size:0.8rem;color:#707070;margin-top:3px}@media(orientation:landscape){.timestamp{display:none}}@media(max-width:768px){.controls{flex-direction:column;align-items:flex-start}.search-box{max-width:100%;width:100%}.log-item{flex-wrap:wrap}.timestamp{width:100%;margin-left:40px;margin-top:5px}.log-actions{flex-wrap:wrap}.floating-console-btn{padding:12px 20px;font-size:0.9rem;right:20px;bottom:20px}.clear-all-btn{right:60px}.tab-btn{padding:8px 12px;font-size:0.9rem}}.nolog{text-align:center;font-size:20px;color:var(--text-color);padding:40px 0}.nolog>.fa{margin-right:10px}.notification{position:fixed;top:20px;right:20px;padding:12px 20px;background:#4CAF50;color:white;border-radius:5px;box-shadow:0 2px 10px rgba(0,0,0,0.2);z-index:99999;transform:translateX(120%);transition:transform 0.3s ease}.notification.show{transform:translateX(0)}.notification.warning{background:#ff9800}',e.setAttribute("tcstyle",""),document.head.append(e)}showNotification(e,t=""){this.notification.textContent=e,this.notification.className="notification","warning"===t&&this.notification.classList.add("warning"),this.notification.classList.add("show"),setTimeout(()=>{this.notification.classList.remove("show")},3e3)}captureConsoleLogs(){this.originalConsole={log:console.log,info:console.info,warn:console.warn,error:console.error},console.log=(...e)=>this.captureConsole("log",...e),console.info=(...e)=>this.captureConsole("info",...e),console.warn=(...e)=>this.captureConsole("warn",...e),console.error=(...e)=>this.captureConsole("error",...e),console.debug=(...e)=>this.captureConsole("log",...e),console.time=(e="time")=>{e=String(e);let t=performance.now();this.timerMap.has(e)&&clearTimeout(this.timerMap.get(e).timeoutId);let o=setTimeout(()=>{if(!this.timerMap.has(e))return;let{start:t}=this.timerMap.get(e);this.timerMap.delete(e),this.info(`[time] The tag "${e}" took: ${(performance.now()-t).toFixed(1)}ms(timed out)`)},3e5);this.timerMap.set(e,{start:t,timeoutId:o})},console.timeEnd=(e="time")=>{e=String(e);let t=this.timerMap.get(e);if(!t)return void this.error(`[timeEnd] The tag "${e}" not found`);t.timeoutId&&clearTimeout(t.timeoutId);let o=performance.now()-t.start;this.timerMap.delete(e),this.info(`[time] The tag "${e}" took: ${o.toFixed(1)}ms`)},console.count=(e="count")=>{e=String(e);let t=(this.countMap.get(e)||0)+1;this.countMap.set(e,t),this.info(`[count] The tag "${e}" has been called ${t} times`)},console.countReset=(e="count")=>{e=String(e),this.countMap.has(e)?this.countMap.delete(e):this.error(`[countReset] The tag "${e}" not found`)},console.assert=(e,...t)=>{e||this.error("[assertion failed] ",...t)},console.trace=(...e)=>{let t=(new Error).stack.split("\n").slice(2).join("\n");this.warn("[trace] ",...e,"\n"+t)},console.group=e=>this.captureConsole("log",`[Group ${e}]`),console.groupEnd=()=>this.captureConsole("log","[GroupEnd]"),console.clear=()=>this.clearAllLogs(!0)}safeStringify(e,t=2){let o=new WeakSet;return JSON.stringify(e,function(e,t){if("object"==typeof t&&null!==t){if(o.has(t))return"[Circular reference]";if(o.add(t),!Array.isArray(t)&&t.constructor===Object){let e=Object.keys(t).sort((e,t)=>e.localeCompare(t,void 0,{numeric:!0,sensitivity:"base"})),o={};for(let s of e)o[s]=t[s];return o}return t instanceof RegExp?t.toString():t instanceof Error?{Name:t.name,Message:t.message,Stack:t.stack}:t instanceof Date?t.toISOString():t instanceof HTMLElement?`<${t.tagName.toLowerCase()}>${t.tagName.toLowerCase()} Element</${t.tagName.toLowerCase()}>`:t}return t instanceof Error?{Name:t.name,Message:t.message,Stack:t.stack}:"function"==typeof t?t.toString().replace(/function /,"").replace(/ { \[native code\] }/,"").replace(/^\(\)/,"function()"):t instanceof Date?t.toISOString():t instanceof HTMLElement?`<${t.tagName.toLowerCase()}>${t.tagName.toLowerCase()} Element</${t.tagName.toLowerCase()}>`:t},t)}formatArgsForPlainText(e){return Array.from(e).map(e=>{if("object"==typeof e&&null!==e)try{return this.safeStringify(e)}catch{return"[Non-serializable object]"}return String(e)}).join(" ")}captureConsole(e,...t){this.triggerGlobalHook("beforeLog",e,...t);let o=new Date,s=t.map(e=>{if("object"==typeof e&&null!==e)try{if(e instanceof Date)return`Date:${e.getTime()}`;if(e instanceof RegExp)return`RegExp:${e.toString()}`;if(e instanceof Error)return`Error:${e.message}`;let t=Object.entries(e).reduce((e,[t,o])=>{if("then"===t&&"function"==typeof o)return e;if("object"==typeof o&&null!==o)try{e[t]=JSON.stringify(o)}catch{e[t]="NestedObject"}else e[t]=o;return e},{});return`[Object]:${JSON.stringify(t)}`}catch{return`Cannot be serialized:${Math.random().toString(36).substring(2,10)}`}return`${typeof e}:${String(e)}`}).join("|"),i=t.length>0&&"string"==typeof t[0]&&t[0].startsWith("[system]");if(this.lastLog&&this.lastLog.type===e&&this.lastLog.contentSign===s){this.lastLog.args=[...t],this.lastLog.timestamp=new Date,this.lastLog.count++;let o=this.systemLogs.find(e=>e.id===this.lastLog.id);if(t.some(e=>"object"==typeof e&&null!==e)){let e=this.safeStringify(t[0]);this.jsonPageIndex.has(e)||(this.jsonPageIndex.set(e,0),this.getPagedJson(t[0],0))}if(o||this.lastLog.isSystem&&(this.systemLogs.push(this.lastLog),o=this.lastLog),i){o.args=[...t],o.timestamp=new Date,o.count=this.lastLog.count;let e=document.getElementById(`sys-log-item-${o.id}`);if(e){let t=e.querySelector(".log-count");t||(t=document.createElement("div"),t.className="log-count",e.insertBefore(t,e.firstChild)),t.textContent=this.lastLog.count}}let s=document.getElementById(`log-item-${this.lastLog.id}`);if(s){let e=s.querySelector(".log-count");e||(e=document.createElement("div"),e.className="log-count",s.insertBefore(e,s.firstChild)),e.textContent=this.lastLog.count}return this.originalConsole[e].apply(console,t),void this.updateFilterCounts()}{let n={id:this.logs.length,type:e,args:[...t],content:this.formatArgsForPlainText(t),timestamp:o,count:1,expandedJson:!1,contentSign:s,hasObject:t.some(e=>"object"==typeof e&&null!==e||"function"==typeof e&&!/^class\s/.test(e.toString())),isError:"error"===e||t.some(e=>e instanceof Error),isSystem:i};if(i){let e={...n};e.id=this.systemLogs.length,this.systemLogs.push(e)}this.logs.push(n),this.lastLog=n,this.triggerGlobalHook("afterLog",n)}this.originalConsole[e].apply(console,t),this.overlay?.classList.contains("active")&&("console"===this.currentTab?(this.updateFilterCounts(),this.renderLogList(this.logs.filter(e=>!e.isSystem),!1)):"system"===this.currentTab&&i&&(this.updateFilterCounts(),this.renderLogList(this.systemLogs,!0))),[this.logs,this.systemLogs].forEach(e=>e.length>this.maxLog&&e.splice(0,e.length-this.maxLog))}formatArgs(e,t){return Array.from(e).map(e=>{if("function"==typeof e)return`<div class="function-preview">${String(e)}</div>`;if(e instanceof Error)return`<div class="error-stack"><strong>${e.name}:</strong> ${e.message}<div>${e.stack||"No stack information"}</div></div>`;if(e instanceof HTMLElement)return`<div class="object-preview">&lt;${e.tagName.toLowerCase()}&gt;${e.tagName.toLowerCase()} Element&lt;/${e.tagName.toLowerCase()}&gt;</div>`;if("object"==typeof e&&null!==e){let o="log-"+t,s=this.jsonPageIndex.get(o)||0,i=this.getPagedJson(e,s),n=this.getJsonKeys(e).length,a=Math.ceil(n/this.jsonPageSize),r=this.safeStringify(i,2).replace(/\\t/g,"").replace(/\\n/g,"\n").replace(/</g,"&lt;").replace(/>/g,"&gt;"),l='<div class="json-preview">'+this.highlightJson(r)+"</div>";return a>1&&(encodeURIComponent(o),l+=`<div style="margin-top:10px;display:flex;justify-content:center;gap:10px;align-items:center;"><button class="log-action json-page-btn" data-id="${t}" title="Previous page" data-page="${Math.max(s-1,0)}"><i class="fa fa-angle-left"></i>Previous page</button><span style="color:#707070">${s+1}/${a}</span><button class="log-action json-page-btn" data-id="${t}" title="Next page" data-page="${Math.min(s+1,a-1)}">Next page<i class="fa fa-angle-right"></i></button></div>`),l}return String(e).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\\n/g,"<br>")}).join(" ")}highlightJson(e){return e?e.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(\.\d*)?([eE][+-]?\d+)?|\{|\}|\[|\]|\.|,)/g,e=>{let t="json-number";return/^"/.test(e)?(t=/:$/.test(e)?"json-key":"json-string",/^"[^"]*\(\)"$/.test(e)&&(t="json-boolean",e=(e="ƒ "+e.replace(/"/g,"")).replace(/(\(\))/g,"<span class='json-cmt'>$&</span>"))):/true|false/.test(e)?t="json-boolean":/null/.test(e)?t="json-null":/(?<!\d)\.(?!\d)|[\{\}\[\],]/.test(e)&&(t="json-cmt"),'<span class="'+t+'">'+e+"</span>"}):""}getJsonKeys(e){return Array.isArray(e)?e.map((e,t)=>t):"object"==typeof e&&null!==e?Object.keys(e):[]}getPagedJson(e,t){let o=this.safeStringify(e);if(!this.jsonPageCache.has(o)){let t=this.getJsonKeys(e),s=[];for(let e=0;e<t.length;e+=this.jsonPageSize)s.push(t.slice(e,e+this.jsonPageSize));this.jsonPageCache.set(o,s)}let s=this.jsonPageCache.get(o)[t]||[];if(Array.isArray(e))return s.map(t=>e[t]);{let t={};return s.forEach(o=>t[o]=e[o]),t}}changeJsonPage(e,t){let o=`log-${e}`;this.jsonPageIndex.set(o,t);let s=[...this.logs,...this.systemLogs].find(t=>t.id===e);if(s){let t=this.systemLogs.includes(s);this.updateLogItem(e,t)}}toggleExpandJson(e){let t="system"===this.currentTab,o=(t?this.systemLogs:this.logs).find(t=>t.id===e);if(!o)return;let s=!o.expandedJson;if(o.expandedJson=s,s){let e=o.args[0];if("object"==typeof e&&null!==e){let t=this.safeStringify(e);this.jsonPageIndex.set(t,0)}}this.updateLogItem(e,t)}updateLogItem(e,t=!1){let o=(t?this.systemLogs:this.logs).find(t=>t.id===e);if(!o)return;let s=document.getElementById(`${t?"sys-":""}log-item-${e}`);if(!s)return;let i={info:"fa fa-info-circle",warn:"fa fa-exclamation-triangle",error:"fa fa-times-circle",log:"fa fa-info"}[o.type]||"fa fa-info",n=o.timestamp.toLocaleTimeString(),a=o.timestamp.toLocaleDateString(),r=o.expandedJson?this.formatArgs(o.args,o.id).replace(/^\[system](?! )|^\[system] /,""):o.args.map(e=>"function"==typeof e?/^class\s/.test(e.toString())?`<span class='json-boolean'>[Class ${e.name}]</span>`:`<span class='json-boolean'>ƒ ${e.name}</span><span class='json-cmt'>()</span>`:"object"==typeof e&&null!==e?e instanceof Error?`<strong>${e.name}:</strong>${e.message}`:e instanceof HTMLElement?`<span class='json-number'>&lt;${e.tagName.toLowerCase()}&gt;</span>`:'<span class="json-cmt">{Object}</span>':String(e).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")).join(" ").replace(/^\[system](?! )|^\[system] /,""),l=[];o.hasObject&&l.push(`<div class="log-action" title="${o.expandedJson?"Collapse":"Expand"}" onclick="thinConsole.tC.toggleExpandJson(${e})"><i class="fa ${o.expandedJson?"fa-chevron-up":"fa-chevron-down"}"></i>${o.expandedJson?"Collapse":"Expand"}</div>`),l.push(`<div class="log-action copy-btn" title="Copy" onclick="thinConsole.tC.copyLog(${e},${t})"><i class="fa fa-copy"></i></div>`),s.innerHTML=`${o.count>1?`<div class="log-count">${o.count}</div>`:""}<div class="log-icon"><i class="${i}"></i></div><div class="log-content">${r}<div class="log-actions">${l.join("")}<div class="timestamp normal-timestamp ${o.hasObject?"hasobj-tsp":""}">${a} ${n}</div></div></div>`}updateFilterCounts(){if(!this.filterButtons)return;let e=[];"console"===this.currentTab?e=this.logs.filter(e=>!e.isSystem):"system"===this.currentTab&&(e=this.systemLogs);let t=(e,t)=>e.reduce((e,o)=>o.type===t?e+(o.count||1):e,0),o={all:e.reduce((e,t)=>e+(t.count||1),0),log:t(e,"log"),info:t(e,"info"),warn:t(e,"warn"),error:t(e,"error")};this.filterButtons.forEach(e=>{let t=e.dataset.type,s=o[t]||0;if(e.dataset.originalHtml||(e.dataset.originalHtml=e.innerHTML),e.classList.contains("active")){let t=s>99?"99+":s;e.innerHTML=`${e.dataset.originalHtml} (${t})`}else e.innerHTML=e.dataset.originalHtml})}renderContent(){if(this.triggerGlobalHook("beforeRender",this.currentTab),this.consoleOutput.style.display="none",this.localstorageView.style.display="none",this.systemLogsEl.style.display="none",this.clearLogsBtn.style.display="none",Object.values(this.pluginViewContainers).forEach(e=>{e.style.display="none"}),this.consoleControls.style.display="flex",["console","system","localstorage"].includes(this.currentTab))switch(this.clearLogsBtn.style.display="block",this.currentTab){case"console":this.consoleOutput.style.display="block",this.renderLogList(this.logs.filter(e=>!e.isSystem),!1),this.updateFilterCounts();break;case"localstorage":this.localstorageView.style.display="block",this.consoleControls.style.display="none",this.renderLocalStorage();break;case"system":this.systemLogsEl.style.display="block",this.renderLogList(this.systemLogs,!0),this.updateFilterCounts()}else if(this.pluginViewContainers[this.currentTab]){let e=Object.keys(this.pluginTabs).find(e=>this.pluginTabs[e].id===this.currentTab);if(this.consoleControls.style.display="none",e){let t=this.pluginViewContainers[this.currentTab];t.style.display="block";let o=this.plugins[e];o&&"function"==typeof o.onShow&&o.onShow(),o&&"function"==typeof o.render&&o.render(t)}}this.triggerGlobalHook("afterRender",this.currentTab)}renderLogList(e,t){let o=t?this.systemLogsEl:this.consoleOutput,s=t?"system logs":"log record";if(!o)return;if(0===e.length)return void(o.innerHTML=`<div class="nolog"><i class="fa fa-${t?"server":"info-circle"}"></i>No ${s}</div>`);let i=[...e];if(this.activeFilter&&"all"!==this.activeFilter&&(i=i.filter(e=>e.type===this.activeFilter)),this.searchQuery){let e,t=this.searchQuery.trim(),o=!1;if(t.startsWith("/")&&t.endsWith("/"))try{let s=t.slice(1,-1),i=s.lastIndexOf("/"),n="";i>0?(n=s.slice(i+1),e=new RegExp(s.slice(0,i),n)):e=new RegExp(s),o=!0}catch{this.showNotification("Invalid regex:"+t),o=!1}let s=o?t:t.toLowerCase();i=i.filter(t=>t.args.some(t=>{let i;return i=t instanceof Error?"[error]":null==t?"null":void 0===t?"undefined":"object"==typeof t?"<span class='json-cmt'>{Object}</span>":String(t),o&&e?e.test(i):i.toLowerCase().includes(s.toLowerCase())}))}if(0===i.length)return void(o.innerHTML=`<div class="nolog"><i class="fa fa-search"></i>No matching ${s}</div>`);let n=i.map(e=>{let o;switch(e.type){case"info":o="fa fa-info-circle";break;case"warn":o="fa fa-exclamation-triangle";break;case"error":o="fa fa-times-circle";break;default:o="fa fa-info"}let s=e.timestamp.toLocaleTimeString(),i=e.timestamp.toLocaleDateString();return t?`<div class="log-item ${e.type}" id="sys-log-item-${e.id}">${e.count>1?`<div class="log-count">${e.count}</div>`:""}<div class="log-icon"><i style="margin-right:5px" class="${o}"></i>${e.type}</div><div class="system-log-date">${i} ${s}</div><div class="system-log-content">${e.expandedJson?this.formatArgs(e.args,e.id).replace(/^\[system](?! )|^\[system] /,""):e.args.map(t=>"function"==typeof t?/^class\s/.test(t.toString())?`<span class='json-boolean'>[Class ${t.name}]</span>`:`<span class='json-boolean'>ƒ ${t.name}</span><span class='json-cmt'>()</span>`:"object"!=typeof t||e.expandedJson?String(t).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>"):t instanceof Error?`<strong>${t.name}:</strong>${t.message}`:t instanceof HTMLElement?`<span class="json-number">&lt;${t.tagName.toLowerCase()}&gt;</span>`:'<span class="json-cmt">{Object}</span>').join(" ").replace(/^\[system](?! )|^\[system] /,"")}</div>${e.hasObject?`<div class="log-actions"><div class="log-action" title="${e.expandedJson?"Collapse":"Expand"}" onclick="thinConsole.tC.toggleExpandJson(${e.id})"><i class="fa ${e.expandedJson?"fa-chevron-up":"fa-chevron-down"}"></i>${e.expandedJson?"Collapse":"Expand"}</div><div class="log-action copy-btn" title="Copy" onclick="thinConsole.tC.copyLog(${e.id},true)"><i class="fa fa-copy"></i></div></div>`:`<div class="log-actions"><div class="log-action copy-btn" title="Copy" onclick="thinConsole.tC.copyLog(${e.id},true)"><i class="fa fa-copy"></i></div></div>`}</div>`:`<div class="log-item ${e.type}" id="log-item-${e.id}">${e.count>1?`<div class="log-count">${e.count}</div>`:""}<div class="log-icon"><i class="${o}"></i></div><div class="log-content">${e.expandedJson?this.formatArgs(e.args,e.id):e.args.map(t=>"function"==typeof t?/^class\s/.test(t.toString())?`<span class='json-boolean'>[Class ${t.name}]</span>`:`<span class='json-boolean'>ƒ ${t.name}</span><span class='json-cmt'>()</span>`:"object"!=typeof t||e.expandedJson?String(t).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>"):t instanceof Error?`<strong>${t.name}:</strong>${t.message}`:t instanceof HTMLElement?`<span class="json-number">&lt;${t.tagName.toLowerCase()}&gt;</span>`:'<span class="json-cmt">{Object}</span>').join(" ")}<div class="log-actions">${e.hasObject?`<div class="log-action" title="${e.expandedJson?"Collapse":"Expand"}" onclick="thinConsole.tC.toggleExpandJson(${e.id})"><i class="fa ${e.expandedJson?"fa-chevron-up":"fa-chevron-down"}"></i>${e.expandedJson?"Collapse":"Expand"}</div><div class="log-action copy-btn" title="Copy" onclick="thinConsole.tC.copyLog(${e.id},false)"><i class="fa fa-copy"></i></div>`:`<div class="log-action copy-btn" title="Copy" onclick="thinConsole.tC.copyLog(${e.id},false)"><i class="fa fa-copy"></i></div>`}<div class="timestamp normal-timestamp${e.hasObject?" hasobj-tsp":""}">${i} ${s}</div></div></div></div>`}).join("");o.innerHTML=n,Number(o.dataset.bottom||0)<50&&(o.scrollTop=o.scrollHeight),[...o.querySelectorAll(".log-item")].slice(0,-this.maxLog).forEach(e=>e.remove())}copyLog(e,t=!1,o=!1){if(o){let t=localStorage.getItem(e);t&&navigator.clipboard.writeText(t).then(()=>this.showNotification(`The value of "${e}" has been copied`)).catch(e=>console.error("Copy failed:",e))}let s=(t?this.systemLogs:this.logs).find(t=>t.id===e);if(!s)return;let i="";s.count>1&&(i+="["+s.count+" repeats]"),s.args.forEach((e,t)=>{if(t>0&&(i+=" "),"object"==typeof e&&null!==e)try{i+=this.safeStringify(e,2)}catch{i+="{object}"}else i+=String(e)}),t&&(i=i.replace(/\[system](?! )|\[system] /,"")),navigator.clipboard.writeText(i).then(()=>this.showNotification("Copied to clipboard")).catch(e=>console.error("Copy failed:",e))}clearAllLogs(e=!1){if(this.triggerGlobalHook("beforeClear"),e)return this.logs=[],this.systemLogs=[],this.lastLog=null,this.renderContent(),void this.updateFilterCounts();if("localstorage"==this.currentTab)return void(confirm("Are you sure you want to clear all localStorage?This action cannot be undone.")&&(localStorage.clear(),this.renderLocalStorage()));let t="system"==this.currentTab;confirm(`Are you sure you want to clear all ${t?"system":"normal"} logs?This action cannot be undone.`)&&(t?this.systemLogs=[]:this.logs=[],this.lastLog=null,this.renderContent(),this.updateFilterCounts(),this.showNotification(`All ${t?"system":"general"} logs have been cleared`,"warning"),this.triggerGlobalHook("afterClear"))}renderLSJsonPage(e,t,o){let s=this.getJsonKeys(t).length,i=Math.ceil(s/this.lsJsonPageSize);this.lsJsonPageIndex.set(e,o);let n=this.getJsonKeys(t),a=o*this.lsJsonPageSize,r=Math.min(a+this.lsJsonPageSize,n.length),l=n.slice(a,r),c=Array.isArray(t)?l.map(e=>t[e]):Object.fromEntries(l.map(e=>[e,t[e]])),d=this.safeStringify(c,2).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\\n/g,""),h='<div class="json-preview ls-json-preview">'+this.highlightJson(d);if(i>1){let t=encodeURIComponent(e);h+=`<div style="display:flex;justify-content:center;gap:10px;margin-top:8px;"><button class="log-action ls-json-page-btn" data-key="${t}" title="Previous page" data-page="${Math.max(o-1,0)}"><i class="fa fa-angle-left"></i>Previous page</button><span style="color:#707070;margin-top:3px">${o+1}/${i}</span><button class="log-action ls-json-page-btn" data-key="${t}" title="Next page" data-page="${Math.min(o+1,i-1)}">Next page<i class="fa fa-angle-right"></i></button></div>`}h+="</div>",this.findLSItem(e).querySelector(".ls-value").style.background="inherit";let g=this.findLSItem(e).querySelector(".ls-json-pages");g&&(g.innerHTML=h)}changeLSJsonPage(e,t){let o=decodeURIComponent(e),s=localStorage.getItem(o);if(s)try{let e=JSON.parse(s);this.renderLSJsonPage(o,e,t)}catch(e){console.error("Parsing error:",e)}}renderLocalStorage(){if(this.lsItems.innerHTML="",this.isLSEmpty())return void(this.lsItems.innerHTML='<div class="nolog"><i class="fa fa-database"></i>No data in localStorage</div>');let e=[];for(let t=0;t<localStorage.length;t++)e.push(localStorage.key(t));e.sort((e,t)=>e.localeCompare(t,void 0,{numeric:!0,sensitivity:"base"}));for(let t of e){let e=localStorage.getItem(t);this.addLSItemToDOM(t,e)}}addLSItemToDOM(e,t){let o=this.escapeHtml(e),s=document.createElement("div");s.className="ls-item",s.dataset.key=o;let{displayValue:i,valueType:n,isJSON:a}=this.parseAndTypeCheck(t),r=a?this.highlightJson(i):this.escapeHtml(i),l="";if(a){let s=JSON.parse(t);this.getJsonKeys(s).length>this.lsJsonPageSize?(l=`<div class="ls-value"><div class="ls-json-pages" data-key="${o}"></div></div>`,this.lsJsonPageIndex.set(e,0),setTimeout(()=>this.renderLSJsonPage(e,s,0))):l=`<div class="ls-value"><pre>${r}</pre></div>`}else l=`<div class="ls-value" title="${i}"><span class="json-${n}">${"string"===n?'"':""}${r}${"string"===n?'"':""}</span></div>`;s.innerHTML=`<div class="ls-key-row"><input class="ls-key-edit" value="${o}" data-old-key="${o}"/><div class="ls-key" title="${o}">${o}</div><div class="ls-actions"><button class="ls-action-btn" data-action="edit" data-key="${o}" title="Edit"><i class="fa fa-edit"></i></button><button class="ls-action-btn" data-action="copy" data-key="${o}" title="Copy"><i class="fa fa-copy"></i></button><button class="ls-action-btn" data-action="remove" data-key="${o}" title="Delete"><i class="fa fa-trash"></i></button></div></div>${l}<div class="ls-value-type">Type:${n}</div><div class="ls-edit" style="display:none"><textarea class="ls-edit-input">${this.escapeHtml(t)}</textarea><div class="ls-edit-actions"><button class="ls-action-btn" data-action="cancel" title="Cancel" data-key="${o}">Cancel</button><button class="ls-action-btn" data-action="save" title="Save" data-key="${o}">Save</button></div></div>`,this.lsItems.appendChild(s);let c=this.lsItems.querySelector(".nolog");c&&(c.style.display=this.isLSEmpty()?"block":"none")}parseAndTypeCheck(e){try{let t=JSON.parse(e);return"object"==typeof t&&null!==t?{displayValue:this.safeStringify(t,2).replace(/</g,"&lt;").replace(/>/g,"&gt;"),valueType:Array.isArray(t)?"array":"object",isJSON:!0}:null==t?{displayValue:null,valueType:null,isJSON:!1}:{displayValue:e,valueType:typeof t,isJSON:!1}}catch{return{displayValue:e,valueType:"string",isJSON:!1}}}isLSEmpty(){return!Array.from({length:localStorage.length},(e,t)=>localStorage.key(t)).some(e=>(e||"").trim())}escapeHtml(e){return String(e).replace(/</g,"&lt;").replace(/>/g,"&gt;")}addLSItem(){let e=(prompt("Please enter the key name:")||"").trim();if(!e)return;if(null!==localStorage.getItem(e))return void alert(`The key name "${e}" already exists!`);let t,o=prompt(`Please enter the value of "${e}":`);try{let e=this.fixKeysOnly(o),s=JSON.parse(e);t=JSON.stringify(s)}catch{t=o}localStorage.setItem(e,t),this.addLSItemToDOM(e,t),this.showNotification(`Key "${e}" has been added`)}editLSItem(e){this.lsItems.querySelectorAll(".ls-item").forEach(e=>{e.classList.remove("editing"),e.querySelector(".ls-value").style.display="block",e.querySelector(".ls-edit").style.display="none";let t=e.querySelector(".ls-value-type");t&&(t.style.display="block")});let t=this.findLSItem(e);if(!t)return;t.classList.add("editing"),t.querySelector(".ls-value").style.display="none",t.querySelector(".ls-edit").style.display="block";let o=t.querySelector(".ls-value-type");o&&(o.style.display="none");let s=t.querySelector(".ls-edit-input");s&&s.focus()}saveLSItem(e){let t=this.findLSItem(e);if(!t)return;let o=t.querySelector(".ls-key-edit").value.trim();if(!o)return void this.showNotification("The key name is required","warning");let s,i=t.querySelector(".ls-key-edit").dataset.oldKey,n=this.fixKeysOnly(t.querySelector(".ls-edit-input").value);try{s=JSON.stringify(JSON.parse(n))}catch{s=n}if(o===i)return localStorage.setItem(i,s),this.updateLSItemView(i),this.cancelEditLSItem(i),void this.showNotification(`Key "${i}" saved`);null===localStorage.getItem(o)?(localStorage.removeItem(i),localStorage.setItem(o,s),t.querySelector(".ls-key-edit").dataset.oldKey=o,t.dataset.key=o,this.updateLSItemView(o),this.cancelEditLSItem(o),this.showNotification(`Key "${i}" saved`)):this.showNotification(`The key name "${o}" already exists!`,"warning")}fixKeysOnly(e){try{return JSON.parse(e),e}catch{return e.replace(/([{,])\s*([a-zA-Z_]\w*)\s*:/g,'$1"$2":').replace(/(":)\s*(?!true|false|null|\d+(\.\d+)?)([^\s,"{[}\]]+?)\s*(?=,|})/gs,'$1"$3"')}}cancelEditLSItem(e){let t=this.findLSItem(e);if(!t)return;t.classList.remove("editing"),t.querySelector(".ls-value").style.display="block",t.querySelector(".ls-edit").style.display="none";let o=t.querySelector(".ls-value-type");o&&(o.style.display="block"),this.renderLocalStorage()}removeLSItem(e){if(!confirm(`Are you sure you want to delete the key "${e}"?`))return;localStorage.removeItem(e);let t=this.findLSItem(e);t&&(t.remove(),this.showNotification(`Deleted "${e}"`,"warning"),this.renderLocalStorage())}findLSItem(e){return this.overlay.querySelector(`.ls-item[data-key="${e}"]`)}updateLSItemView(e){let t=this.findLSItem(e);if(!t)return;let o,s=localStorage.getItem(e);if(null===s)return void t.remove();let i=!1;try{o=JSON.parse(s),o&&"object"==typeof o&&(i=!0)}catch{}let n=i?"JSON":typeof s;t.innerHTML=`<div class="ls-key-row"><div class="ls-key" title="${e}">${e}</div><div class="ls-actions"><button class="ls-action-btn" onclick="thinConsole.tC.editLSItem('${e}')" title="Edit"><i class="fa fa-edit"></i></button><button class="ls-action-btn" onclick="thinConsole.tC.copyLog('${e}','',true)" title="Copy"><i class="fa fa-copy"></i></button><button class="ls-action-btn" onclick="thinConsole.tC.removeLSItem('${e}')" title="Delete"><i class="fa fa-trash"></i></button></div></div><div class="ls-value" title="${s}">${s.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</div><div class="ls-value-type" title="${n}">Type:${n}</div><div class="ls-edit"><textarea class="ls-edit-input">${s.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</textarea><div class="ls-edit-actions"><button class="ls-action-btn" title="Cancel" onclick="thinConsole.tC.cancelEditLSItem('${e}')">Cancel</button><button class="ls-action-btn" title="Save" onclick="thinConsole.tC.saveLSItem('${e}')">Save</button></div></div>`}setupGlobalEventHandlers(){this.activeFilter="all",this.searchQuery="",this.tCError=e=>{""!==e.filename||0!==e.lineno||0!==e.colno?(this.error(e.error.toString(),{ErrorMessage:e.message||" No error message.",FileName:e.filename||"Unknown",Position:`${e.lineno}:${e.colno}`||"0:0",TrustedEvent:e.isTrusted||!0,Type:e.type||"error"}),e.preventDefault()):this.error("Script error.")},this.tCUR=e=>{this.error("Unhandled Promise Exception:",e.reason),e.preventDefault()},this.RSError=e=>{let t=new Set(["IMG","SCRIPT","LINK","VIDEO","AUDIO","SOURCE","TRACK"]),o=e.target;if(!t.has(o.tagName))return;let s=o.src||o.href||o.currentSrc||"[Unknown path]";this.error(`[Resource Error] <${o.tagName.toLowerCase()}> Failed to load resource: ${s}`)},document.addEventListener("error",this.RSError,!0),window.addEventListener("error",this.tCError),window.addEventListener("unhandledrejection",this.tCUR)}setupSelfProtection(){if(this.protectInterval)return;let t=this;this.protectInterval=setInterval(()=>{window.thinConsole&&window.thinConsole.tC!==t&&(window.thinConsole.tC=t);let e=document.getElementById("thinConsole-btn");e&&document.documentElement.contains(e)?"flex"!==e.style.display&&(e.style.display="flex"):(t.btn=null,t.createButton());let s=document.getElementById("consoleOverlay");s&&document.documentElement.contains(s)?"flex"!==s.style.display&&(s.style.display="flex"):(t.overlay=null,t.createOverlayElement(),t.createStyles()),document.head.querySelector("style[tcstyle]")||t.createStyles();let i=document.getElementById("notification");i&&document.documentElement.contains(i)?"block"!==i.style.display&&(i.style.display="block"):(t.notification=null,t.createNotificationElement());let o=e=>{if(!e||1!==e.nodeType)return;let t=t=>{"false"!==t.contentEditable&&(t.contentEditable="false",t.dataset.tcLock="1",n.observe(t,{attributes:!0,attributeFilter:["contenteditable"]}))};t(e),e.querySelectorAll("*").forEach(t)},n=new MutationObserver(e=>{e.forEach(e=>{"attributes"===e.type&&"contentEditable"===e.attributeName&&"true"===e.target.contentEditable&&e.target.dataset.tcLock&&(e.target.contentEditable="false")})});setTimeout(()=>{o(t.btn),o(t.overlay),o(t.notification)},0)},5e3)}disablePlugin(e){return this.disabledPlugins.includes(e)||this.disabledPlugins.push(e),this.destroyPlugin(e),this}enablePlugin(e){return this.disabledPlugins=this.disabledPlugins.filter(t=>t!==e),this.loadSinglePlugin(e),this}loadSinglePlugin(e){if(!this.disabledPlugins.includes(e)&&thinConsole.plugins[e]&&!this.plugins[e]){try{let t=thinConsole.plugins[e],o=new t(this,t.config);if(o.init(),this.plugins[e]=o,o.addTab){let t=o.addTab();this.createPluginTab(t),this.pluginTabs[e]={id:t.id,name:t.name,icon:t.icon||"fa fa-plug",plugin:o}}this.triggerGlobalHook("pluginMount",e,o)}catch(t){console.error(`Plugin "${e}" failed to load:`,t)}return this}}initPlugins(){return Object.keys(thinConsole.plugins).forEach(e=>{this.disabledPlugins.includes(e)||this.loadSinglePlugin(e)}),this}destroyPlugin(e){let t=this.plugins[e];if(!t)return;"function"==typeof t.destroy&&t.destroy();let o=this.pluginTabs[e]?.id;if(o){let e=this.overlay.querySelector(`.tab-btn[data-tab="${o}"]`);e?.remove();let t=this.pluginViewContainers[o];t?.remove(),delete this.pluginViewContainers[o]}return delete this.plugins[e],delete this.pluginTabs[e],this.triggerGlobalHook("pluginUnmount",e),this}triggerGlobalHook(e,...t){return thinConsole.hooks[e]&&thinConsole.hooks[e].forEach(o=>{try{o.call(this,...t)}catch(t){console.error(`Hook "${e}" execution failed:`,t)}}),this}initShortcuts(){document.addEventListener("keydown",e=>{e.ctrlKey&&e.shiftKey&&"c"===e.key.toLowerCase()&&(e.preventDefault(),this.overlay||this.createOverlayElement(),this.triggerGlobalHook("beforeOpen"),this.overlay.classList.add("active","theme-"+this.currentTheme),this.renderContent(),this.triggerGlobalHook("afterOpen"),this.enableShortcuts())}),this.enableShortcuts=()=>{this.shortcutHandler||(this.shortcutHandler=e=>this.handlePanelShortcuts(e),document.addEventListener("keydown",this.shortcutHandler))},this.disableShortcuts=()=>{this.shortcutHandler&&(document.removeEventListener("keydown",this.shortcutHandler),this.shortcutHandler=null)},thinConsole.addHook("afterClose",()=>this.disableShortcuts())}handlePanelShortcuts(e){let t=e.target,o="INPUT"===t.tagName||"TEXTAREA"===t.tagName,s=e.key.toLowerCase();if("Escape"===e.key)return e.preventDefault(),void this.closeConsoleBtn.click();if(e.ctrlKey&&"enter"===s){let t=this.overlay.querySelector('.ls-item.editing .ls-edit-actions button[data-action="save"]');return void(t&&(e.preventDefault(),t.click()))}if(!e.altKey||e.shiftKey||e.ctrlKey)if(e.altKey&&e.shiftKey&&!e.ctrlKey)switch(s){case"c":e.preventDefault(),this.switchTab("console");break;case"s":e.preventDefault(),this.switchTab("system");break;case"l":e.preventDefault(),this.switchTab("localstorage")}else"/"!==s||o||(e.preventDefault(),this.searchInput.focus());else switch(s){case"c":e.preventDefault(),this.clearLogsBtn.click();break;case"a":case"l":case"i":case"w":case"e":e.preventDefault();let t={a:"all",l:"log",i:"info",w:"warn",e:"error"},o=Array.from(this.filterButtons).find(e=>e.dataset.type===t[s]);o&&o.click()}}switchTab(e){let t=Array.from(this.tabButtons).find(t=>t.dataset.tab===e);t&&t.click()}destroy(){thinConsole.tC===this&&(Object.assign(console,this.originalConsole),Object.keys(this.plugins).forEach(e=>this.destroyPlugin(e)),clearInterval(this.protectInterval),clearInterval(this.themeChangeHandler),this.btn?.remove(),this.overlay?.remove(),this.notification?.remove(),document.head.querySelector("style[tcstyle]").remove(),document.removeEventListener("error",this.RSError,!0),window.removeEventListener("error",this.tCError),window.removeEventListener("unhandledrejection",this.tCUR),this.disableShortcuts(),this.globalKeyHandler&&(document.removeEventListener("keydown",this.globalKeyHandler),this.globalKeyHandler=null),thinConsole.tC=null)}log(...e){return console.log(...e),this}info(...e){return console.info(...e),this}warn(...e){return console.warn(...e),this}error(...e){return console.error(...e),this}systemLog(...e){return console.log("[system]",...e),this}systemInfo(...e){return console.info("[system]",...e),this}systemWarn(...e){return console.warn("[system]",...e),this}systemError(...e){return console.error("[system]",...e),this}show(e="console"){return this.overlay||this.createOverlayElement(),this.switchTab(e),this.triggerGlobalHook("beforeOpen"),this.overlay.classList.add("active","theme-"+this.currentTheme),this.triggerGlobalHook("afterOpen"),this}hide(){return this.overlay&&(this.triggerGlobalHook("beforeClose"),this.overlay.classList.remove("active"),this.triggerGlobalHook("afterClose")),this}}thinConsole.plugins={},window.thinConsole=thinConsole,thinConsole.tC=null,thinConsole.hooks={beforeRender:[],afterRender:[],beforeLog:[],afterLog:[],beforeOpen:[],afterOpen:[],beforeClose:[],afterClose:[],beforeClear:[],afterClear:[],pluginMount:[],pluginUnmount:[]},thinConsole.addPlugin=function(e,t,o={}){if(thinConsole.tC){if(t.prototype instanceof tCPlugin){if(t.config=o,thinConsole.plugins[e]=t,thinConsole.tC.disabledPlugins.includes(e))return;if(thinConsole.tC.pluginEnabled&&!thinConsole.tC.plugins[e])try{let s=new t(thinConsole.tC,o);if(s.init(),thinConsole.tC.plugins[e]=s,s.addTab){let t=s.addTab();thinConsole.tC.pluginTabs[e]={id:t.id,name:t.name,icon:t.icon||"fa fa-tool",plugin:s},thinConsole.tC.createPluginTab(t)}thinConsole.tC.triggerGlobalHook("pluginMount",e,s)}catch(t){console.error(`Plugin "${e}" failed to load dynamically:`,t)}}else{if("function"!=typeof t)throw new Error(`The plugin "${e}" must be a class or function`);if(!thinConsole.tC.options.plugins||thinConsole.tC.disabledPlugins.includes(e))return;try{t.call(null,thinConsole.tC,o),thinConsole.tC.triggerGlobalHook("pluginMount",e,null)}catch(t){console.error(`Failed to execute function plugin "${e}":`,t)}}return thinConsole}},thinConsole.addHook=function(e,t){return thinConsole.hooks[e]&&!thinConsole.hooks[e].includes(t)?thinConsole.hooks[e].push(t):console.warn(`Unknown hook:${e}`),thinConsole},thinConsole.removeHook=function(e,t){return thinConsole.hooks[e]&&(thinConsole.hooks[e]=thinConsole.hooks[e].filter(e=>e!==t)),thinConsole};class tCPlugin{constructor(e,t={}){if(!(e instanceof thinConsole))throw new Error("The plugin must be bound to a thinConsole instance.");this.tC=e,this.config=t,this.id=this.constructor.name.toLowerCase()}iszh(){return!1}isen(){return!0}isMobile(){return/iPad|Android(?!.*Mobile)|Mobi|Android|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}init(){}render(e){}onShow(){}onHide(){}destroy(){}}